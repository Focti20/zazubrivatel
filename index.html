<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LearnVerse</title>
    <meta name="description" content="LearnVerse — сайт для заучивания текста с постепенным скрытием слов. Помогает легко и эффективно запоминать стихотворения.">
    <link rel="icon" type="image/png" href="Icon.png">
    <link rel="shortcut icon" type="image/png" href="Icon.png">
    <style>
        * {
            box-sizing: border-box;
            font-family: Consolas, 'Courier New', monospace;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            width: auto;
            max-width: 95%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 25px;
            width: 100%;
            font-size: 32px;
        }
        .header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 20px;
            flex-wrap: wrap;
            width: 100%;
        }
        .level-display {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            min-width: 150px;
            background: #f0f0f0;
            padding: 10px 20px;
            border-radius: 6px;
            text-align: center;
        }
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 24px;
            font-size: 18px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            transition: background-color 0.2s;
            min-width: 130px;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .text-container {
            position: relative;
            margin-bottom: 25px;
            width: 100%;
            display: flex;
            justify-content: center;
        }
        textarea {
            min-height: 300px;
            min-width: 800px; /* Значительно шире */
            padding: 20px;
            font-size: 18px;
            border: 2px solid #ddd;
            border-radius: 8px;
            resize: both;
            line-height: 1.6;
            overflow: auto;
            max-width: 95vw;
            box-sizing: border-box;
            width: 100%;
        }
        #poem-display {
            min-height: 300px;
            min-width: 800px; /* Значительно шире */
            padding: 20px;
            font-size: 18px;
            line-height: 1.6;
            background-color: #f9f9f9;
            border: 2px solid #eee;
            border-radius: 8px;
            white-space: pre-wrap;
            word-wrap: break-word;
            resize: both;
            overflow: auto;
            max-width: 95vw;
            box-sizing: border-box;
            width: 100%;
        }
        .info {
            text-align: left;
            margin-top: 25px;
            color: #666;
            font-size: 17px;
            line-height: 1.7;
            width: 100%;
        }
        .info p {
            margin: 10px 0;
            padding-left: 15px;
        }
        .hidden {
            display: none;
        }
        .resize-handle {
            position: absolute;
            right: 10px;
            bottom: 10px;
            width: 25px;
            height: 25px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23999"><path d="M20 9H4v2h16V9zM4 15h16v-2H4v2z"/></svg>') no-repeat center;
            cursor: se-resize;
            opacity: 0.5;
        }
        .resize-handle:hover {
            opacity: 1;
        }
        .text-wrapper {
            display: flex;
            justify-content: center;
            width: 100%;
        }
        
        /* Адаптивность для мобильных устройств */
        @media (max-width: 900px) {
            textarea, #poem-display {
                min-width: 95vw !important;
                font-size: 16px;
            }
            .container {
                padding: 15px;
            }
            button {
                padding: 10px 15px;
                font-size: 16px;
                min-width: 100px;
            }
            .level-display {
                font-size: 20px;
                min-width: 120px;
                padding: 8px 15px;
            }
            h1 {
                font-size: 28px;
            }
        }
        .site-footer {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100vw;
            background: #f5f5f5;
            text-align: center;
            color: #888;
            font-size: 16px;
            padding: 12px 0 8px 0;
            z-index: 100;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.03);
        }
        @media (max-width: 900px) {
            .site-footer {
                font-size: 14px;
                padding: 10px 0 6px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 25px;">
            <img src="Full_image.png" alt="Логотип" style="height: 80px; width: 80px; object-fit: contain; margin-bottom: -5px;" />
            <h1>LearnVerse</h1>
        </div>
        
        <div class="header-controls">
            <div class="level-display">Уровень: <span id="level-title">0</span></div>
            <div class="controls">
                <button id="decrease">Упростить</button>
                <button id="increase">Усложнить</button>
                <button id="reset">Сбросить</button>
            </div>
        </div>
        
        <div class="text-wrapper">
            <div class="text-container">
                <div id="input-section">
                    <textarea id="poem-text" placeholder="Введите стихотворение здесь..."></textarea>
                </div>
                <div id="display-section" class="hidden">
                    <div id="poem-display"></div>
                    <div class="resize-handle"></div>
                </div>
            </div>
        </div>
        
        <div class="info">
        </div>
    </div>

    <footer class="site-footer">
        &copy; 2025 Хасанов Т.Р.
    </footer>

    <script>
        // Конфигурация уровней сложности
        const LEVELS = [
            { open: 100, partial: 0, closed: 0 },    // Уровень 0
            { open: 88, partial: 12, closed: 0 },     // Уровень 1
            { open: 76, partial: 24, closed: 0 },     // Уровень 2
            { open: 64, partial: 36, closed: 0 },     // Уровень 3
            { open: 52, partial: 48, closed: 0 },     // Уровень 4
            { open: 40, partial: 60, closed: 0 },     // Уровень 5
            { open: 32, partial: 48, closed: 20 },    // Уровень 6
            { open: 24, partial: 36, closed: 40 },    // Уровень 7
            { open: 16, partial: 24, closed: 60 },    // Уровень 8
            { open: 8, partial: 12, closed: 80 },     // Уровень 9
            { open: 0, partial: 0, closed: 100 }      // Уровень 10
        ];

        // Элементы DOM
        const textarea = document.getElementById('poem-text');
        const poemDisplay = document.getElementById('poem-display');
        const levelTitle = document.getElementById('level-title');
        const decreaseBtn = document.getElementById('decrease');
        const increaseBtn = document.getElementById('increase');
        const resetBtn = document.getElementById('reset');
        const inputSection = document.getElementById('input-section');
        const displaySection = document.getElementById('display-section');
        const resizeHandle = document.querySelector('.resize-handle');

        // Состояние приложения
        let appState = {
            text: '',
            level: 0
        };

        // Инициализация приложения
        function init() {
            loadState();
            updateUI();
            setupEventListeners();
            adjustTextareaHeight();
            setupResizeHandle();
        }

        // Автоматическое изменение высоты textarea
        function adjustTextareaHeight() {
            // Сброс высоты перед расчетом
            textarea.style.height = 'auto';
            
            // Рассчитываем новую высоту
            const newHeight = Math.max(300, textarea.scrollHeight);
            
            // Устанавливаем новую высоту
            textarea.style.height = newHeight + 'px';
            
            // Убираем вертикальный скролл
            textarea.style.overflowY = 'hidden';
        }

        // Загрузка состояния из localStorage
        function loadState() {
            const savedState = localStorage.getItem('poemAppState');
            if (savedState) {
                appState = JSON.parse(savedState);
                textarea.value = appState.text;
            }
        }

        // Сохранение состояния в localStorage
        function saveState() {
            localStorage.setItem('poemAppState', JSON.stringify(appState));
        }

        // Настройка обработчиков событий
        function setupEventListeners() {
            textarea.addEventListener('input', handleTextChange);
            textarea.addEventListener('input', adjustTextareaHeight);
            decreaseBtn.addEventListener('click', decreaseLevel);
            increaseBtn.addEventListener('click', increaseLevel);
            resetBtn.addEventListener('click', resetLevel);
            
            // Инициализация высоты при загрузке
            window.addEventListener('load', () => {
                adjustTextareaHeight();
                setTimeout(adjustTextareaHeight, 50);
            });
        }

        // Настройка изменения размера
        function setupResizeHandle() {
            let startX, startY, startWidth, startHeight;
            
            resizeHandle.addEventListener('mousedown', initResize);
            
            function initResize(e) {
                e.preventDefault();
                startX = e.clientX;
                startY = e.clientY;
                startWidth = parseInt(document.defaultView.getComputedStyle(poemDisplay).width, 10);
                startHeight = parseInt(document.defaultView.getComputedStyle(poemDisplay).height, 10);
                document.addEventListener('mousemove', resize);
                document.addEventListener('mouseup', stopResize);
            }
            
            function resize(e) {
                const width = startWidth + (e.clientX - startX);
                const height = startHeight + (e.clientY - startY);
                
                poemDisplay.style.width = `${Math.max(300, width)}px`;
                poemDisplay.style.height = `${Math.max(300, height)}px`;
            }
            
            function stopResize() {
                document.removeEventListener('mousemove', resize);
                document.removeEventListener('mouseup', stopResize);
            }
        }

        // Обработчик изменения текста
        function handleTextChange() {
            appState.text = textarea.value;
            saveState();
        }

        // Уменьшение уровня
        function decreaseLevel() {
            if (appState.level > 0) {
                appState.level--;
                updateUI();
            }
        }

        // Увеличение уровня
        function increaseLevel() {
            if (appState.level < 10) {
                appState.level++;
                updateUI();
            }
        }

        // Сброс уровня
        function resetLevel() {
            appState.level = 0;
            updateUI();
        }

        // Генерация хеша для детерминированного случайного выбора
        function generateHash(str) {
            let hash = 0;
            if (str.length === 0) return hash;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash |= 0;
            }
            return Math.abs(hash);
        }

        // Проверка на знак препинания
        function isPunctuation(char) {
            return /[.,!?;:—–\-'"(){}[\]«»„“”‘’]/u.test(char);
        }

        // Проверка на пробельный символ
        function isWhitespace(char) {
            return /\s/.test(char);
        }

        // Преобразование слова с учетом знаков препинания
        function transformWord(word, state) {
            if (state === 'open') return word;
            
            let result = '';
            if (state === 'closed') {
                for (let i = 0; i < word.length; i++) {
                    result += isPunctuation(word[i]) ? word[i] : '-';
                }
                return result;
            }
            
            // Частичное скрытие
            let firstLetterShown = false;
            for (let i = 0; i < word.length; i++) {
                if (isPunctuation(word[i])) {
                    result += word[i];
                } else if (!firstLetterShown) {
                    result += word[i];
                    firstLetterShown = true;
                } else {
                    result += '-';
                }
            }
            return result;
        }

        // Разделение текста на токены (слова и пробелы)
        function splitTextWithSpaces(text) {
            const tokens = [];
            let word = '';
            let inWord = false;
            
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                
                if (isWhitespace(char)) {
                    if (inWord) {
                        tokens.push(word);
                        word = '';
                        inWord = false;
                    }
                    tokens.push(char);
                } else {
                    if (!inWord && word !== '') {
                        tokens.push(word);
                        word = '';
                    }
                    word += char;
                    inWord = true;
                }
            }
            
            if (word !== '') {
                tokens.push(word);
            }
            
            return tokens;
        }

        // Детерминированный выбор слов для скрытия
        function getWordStates(tokens, level) {
            // Фильтруем только слова (не пробелы)
            const words = tokens.filter(token => !isWhitespace(token));
            if (words.length === 0) return [];
            
            const config = LEVELS[level];
            const totalWords = words.length;
            
            // Рассчитываем количество слов каждого типа
            const openCount = Math.floor(totalWords * config.open / 100);
            const partialCount = Math.floor(totalWords * config.partial / 100);
            const closedCount = totalWords - openCount - partialCount;
            
            // Создаем массив индексов слов
            const indices = Array.from({length: totalWords}, (_, i) => i);
            
            // Создаем seed на основе текста и уровня
            const cleanText = appState.text.replace(/\s+/g, '');
            const seed = generateHash(cleanText + level);
            
            // Исправленный алгоритм перемешивания (Fisher-Yates)
            for (let i = totalWords - 1; i > 0; i--) {
                // Генерируем псевдослучайный индекс
                const pseudoRandom = (seed * 1664525 + 1013904223) % 2**32;
                const j = Math.floor(pseudoRandom % (i + 1));
                
                // Меняем местами текущий элемент со случайным
                [indices[i], indices[j]] = [indices[j], indices[i]];
            }
            
            // Создаем массив состояний для всех слов
            const states = new Array(totalWords).fill('open');
            
            // Применяем состояния к случайным словам
            for (let i = 0; i < totalWords; i++) {
                if (i < openCount) {
                    states[indices[i]] = 'open';
                } else if (i < openCount + partialCount) {
                    states[indices[i]] = 'partial';
                } else {
                    states[indices[i]] = 'closed';
                }
            }
            
            return states;
        }

        // Обновление отображения стихотворения
        function updatePoemDisplay() {
            if (!appState.text.trim()) {
                poemDisplay.textContent = "Введите стихотворение на уровне 0";
                return;
            }

            // Разделяем текст на токены (слова и пробелы)
            const tokens = splitTextWithSpaces(appState.text);
            
            // Получаем состояния только для слов
            const wordStates = getWordStates(tokens, appState.level);
            
            // Собираем результат
            let result = '';
            let wordIndex = 0;
            
            for (const token of tokens) {
                if (isWhitespace(token)) {
                    // Пробелы сохраняем как есть
                    result += token;
                } else {
                    // Обработка слов
                    const state = wordStates[wordIndex++];
                    result += transformWord(token, state);
                }
            }
            
            poemDisplay.textContent = result;
        }

        // Обновление всего интерфейса
        function updateUI() {
            // Обновление уровня
            levelTitle.textContent = appState.level;
            
            // Обновление состояния кнопок
            decreaseBtn.disabled = appState.level === 0;
            increaseBtn.disabled = appState.level === 10;
            
            // Переключение режимов отображения
            if (appState.level === 0) {
                inputSection.classList.remove('hidden');
                displaySection.classList.add('hidden');
                textarea.value = appState.text;
                
                // Гарантированное обновление высоты после отрисовки
                setTimeout(() => {
                    adjustTextareaHeight();
                    // Убедимся, что высота корректна
                    setTimeout(adjustTextareaHeight, 50);
                }, 10);
            } else {
                inputSection.classList.add('hidden');
                displaySection.classList.remove('hidden');
                updatePoemDisplay();
            }
            
            saveState();
        }

        // Инициализация при загрузке страницы
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
